# CommerceML2-tester
> Консольный PHP-скрипт генерирующий обменные файлы CommerceML2 со случайным наполнением и выгружающий их на указанный сервер по протоколу от 1С для тестирования и отладки функционала синхронизации на сайтах.

## Структура файлов

/cmltester.php - основной файл содержащий весь функционал тестера
/temp/ - директория временных файлов, нужны права на запись
/templates/ - директория с шаблонными сгенерированными файлами
/templates/images/ - рандомный архив картинок для товаров

## Использование

1. Клонируем или скачиваем с github
https://github.com/crazy-beard/commerceml-tester/archive/master.zip
```php
$ git clone https://github.com/crazy-beard/commerceml-tester.git
```

2. Наполняем директорию /templates/images/ случайными картинками для товаров.
Можно воспользоваться каким-нибудь набором файлов, например вот этим (500 картинок на 160 Мб), либо "наковырять" с соответствующих сервисов встроенной командой
```php
$ php cmltester.php images
```

3. Генерируем обменные файлы import.xml, offers.xml и rests.xml командой
```php
$ php cmltester.php generate
```
Можно задать количество категорий (примерное), их вложенность и количество товаров которые нужно создать в обменных файлах (в примере дефолтные значения)
```php
$ php cmltester.php generate categories-count=50 categories-level=3 products-count=450
```

4. Сохраняем настройки соединения с сервисом, куда будем грузить файлы, чтобы каждый раз не указывать их в консоли
```php
$ php cmltester.php serv url=http://site.com/1c_exchange user=cmluser pass=password
```

5. Теперь можно запускать процесс синронизации с сервисом принимающим CommerceML2-файлы
```php
$ php cmltester.php exchange
```

6. После первой синхронизации можно изменить подготовленные xml-файлы в директории /temp/ и запустить повторную синхронизацию уже измененных файлов, а не первоначально сгенерированных, которые лежат в директории /templates/. Для этого нужно добавить параметр nocopy
```php
$ php cmltester.php exchange nocopy
```
